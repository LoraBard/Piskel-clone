!function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=3)}([function(t,e,i){var r;!function(i,n,a,o){"use strict";var s,c={URL:i.URL||i.webkitURL||i.mozURL||i.msURL,getUserMedia:(s=a.getUserMedia||a.webkitGetUserMedia||a.mozGetUserMedia||a.msGetUserMedia,s?s.bind(a):s),requestAnimFrame:i.requestAnimationFrame||i.webkitRequestAnimationFrame||i.mozRequestAnimationFrame||i.oRequestAnimationFrame||i.msRequestAnimationFrame,requestTimeout:function(t,e){if(t=t||c.noop,e=e||0,!c.requestAnimFrame)return setTimeout(t,e);var i=(new Date).getTime(),r=new Object,n=c.requestAnimFrame;return r.value=n(function a(){(new Date).getTime()-i>=e?t.call():r.value=n(a)}),r},Blob:i.Blob||i.BlobBuilder||i.WebKitBlobBuilder||i.MozBlobBuilder||i.MSBlobBuilder,btoa:function(){var t=i.btoa||function(t){for(var e="",i=0,r=t.length,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a=void 0,o=void 0,s=void 0,c=void 0,d=void 0,l=void 0,h=void 0;i<r;)c=(a=t.charCodeAt(i++))>>2,d=(3&a)<<4|(o=t.charCodeAt(i++))>>4,l=(15&o)<<2|(s=t.charCodeAt(i++))>>6,h=63&s,isNaN(o)?l=h=64:isNaN(s)&&(h=64),e=e+n.charAt(c)+n.charAt(d)+n.charAt(l)+n.charAt(h);return e};return t?t.bind(i):c.noop}(),isObject:function(t){return t&&"[object Object]"===Object.prototype.toString.call(t)},isEmptyObject:function(t){return c.isObject(t)&&!Object.keys(t).length},isArray:function(t){return t&&Array.isArray(t)},isFunction:function(t){return t&&"function"==typeof t},isElement:function(t){return t&&1===t.nodeType},isString:function(t){return"string"==typeof t||"[object String]"===Object.prototype.toString.call(t)},isSupported:{canvas:function(){var t=n.createElement("canvas");return t&&t.getContext&&t.getContext("2d")},webworkers:function(){return i.Worker},blob:function(){return c.Blob},Uint8Array:function(){return i.Uint8Array},Uint32Array:function(){return i.Uint32Array},videoCodecs:function(){var t=n.createElement("video"),e={mp4:!1,h264:!1,ogv:!1,ogg:!1,webm:!1};try{t&&t.canPlayType&&(e.mp4=""!==t.canPlayType('video/mp4; codecs="mp4v.20.8"'),e.h264=""!==(t.canPlayType('video/mp4; codecs="avc1.42E01E"')||t.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')),e.ogv=""!==t.canPlayType('video/ogg; codecs="theora"'),e.ogg=""!==t.canPlayType('video/ogg; codecs="theora"'),e.webm=-1!==t.canPlayType('video/webm; codecs="vp8, vorbis"'))}catch(t){}return e}()},noop:function(){},each:function(t,e){var i=void 0,r=void 0;if(c.isArray(t))for(i=-1,r=t.length;++i<r&&!1!==e(i,t[i]););else if(c.isObject(t))for(i in t)if(t.hasOwnProperty(i)&&!1===e(i,t[i]))break},mergeOptions:function(t,e){if(c.isObject(t)&&c.isObject(e)&&Object.keys){var i={};return c.each(t,function(e,r){i[e]=t[e]}),c.each(e,function(r,n){var a=e[r];c.isObject(a)&&t[r]?i[r]=c.mergeOptions(t[r],a):i[r]=a}),i}},setCSSAttr:function(t,e,i){c.isElement(t)&&(c.isString(e)&&c.isString(i)?t.style[e]=i:c.isObject(e)&&c.each(e,function(e,i){t.style[e]=i}))},removeElement:function(t){c.isElement(t)&&t.parentNode&&t.parentNode.removeChild(t)},createWebWorker:function(t){if(!c.isString(t))return{};try{var e=new c.Blob([t],{type:"text/javascript"}),i=c.URL.createObjectURL(e);return{objectUrl:i,worker:new Worker(i)}}catch(t){return""+t}},getExtension:function(t){return t.substr(t.lastIndexOf(".")+1,t.length)},getFontSize:function(){var t=arguments.length>0&&arguments[0]!==o?arguments[0]:{};if(!n.body||!1===t.resizeFont)return t.fontSize;var e=t.text,i=t.gifWidth,r=parseInt(t.fontSize,10),a=parseInt(t.minFontSize,10),s=n.createElement("div"),c=n.createElement("span");for(s.setAttribute("width",i),s.appendChild(c),c.innerHTML=e,c.style.fontSize=r+"px",c.style.textIndent="-9999px",c.style.visibility="hidden",n.body.appendChild(c);c.offsetWidth>i&&r>=a;)c.style.fontSize=--r+"px";return n.body.removeChild(c),r+"px"},webWorkerError:!1},d=Object.freeze({default:c}),l={validate:function(t){t=c.isObject(t)?t:{};var e={};return c.each(l.validators,function(i,r){var n=r.errorCode;if(!t[n]&&!r.condition)return(e=r).error=!0,!1}),delete e.condition,e},isValid:function(t){var e=!0!==l.validate(t).error;return e},validators:[{condition:c.isFunction(c.getUserMedia),errorCode:"getUserMedia",errorMsg:"The getUserMedia API is not supported in your browser"},{condition:c.isSupported.canvas(),errorCode:"canvas",errorMsg:"Canvas elements are not supported in your browser"},{condition:c.isSupported.webworkers(),errorCode:"webworkers",errorMsg:"The Web Workers API is not supported in your browser"},{condition:c.isFunction(c.URL),errorCode:"window.URL",errorMsg:"The window.URL API is not supported in your browser"},{condition:c.isSupported.blob(),errorCode:"window.Blob",errorMsg:"The window.Blob File API is not supported in your browser"},{condition:c.isSupported.Uint8Array(),errorCode:"window.Uint8Array",errorMsg:"The window.Uint8Array function constructor is not supported in your browser"},{condition:c.isSupported.Uint32Array(),errorCode:"window.Uint32Array",errorMsg:"The window.Uint32Array function constructor is not supported in your browser"}],messages:{videoCodecs:{errorCode:"videocodec",errorMsg:"The video codec you are trying to use is not supported in your browser"}}},h=Object.freeze({default:l}),u=function(){},m={sampleInterval:10,numWorkers:2,filter:"",gifWidth:200,gifHeight:200,interval:.1,numFrames:10,frameDuration:1,keepCameraOn:!1,images:[],video:null,webcamVideoElement:null,cameraStream:null,text:"",fontWeight:"normal",fontSize:"16px",minFontSize:"10px",resizeFont:!1,fontFamily:"sans-serif",fontColor:"#ffffff",textAlign:"center",textBaseline:"bottom",textXCoordinate:null,textYCoordinate:null,progressCallback:u,completeCallback:u,saveRenderingContexts:!1,savedRenderingContexts:[],showFrameText:!0,crossOrigin:"Anonymous",waterMark:null,waterMarkHeight:null,waterMarkWidth:null,waterMarkXCoordinate:1,waterMarkYCoordinate:1},g=Object.freeze({default:m});function f(){return l.isValid()}function v(){var t,e,i,r,n,a=256,o=499,s=491,c=487,d=503,l=3*d,h=a-1,u=4,m=100,g=16,f=1<<g,v=10,p=10,C=f>>p,y=f<<v-p,w=6,B=(a>>3)*(1<<w),b=30,E=1024,F=256,S=1<<18,x=[],D=[],A=[],k=[];function I(t,e,i,r,o){var s,c,d,l,h,u,m;for((d=e-t)<-1&&(d=-1),(l=e+t)>a&&(l=a),s=e+1,c=e-1,u=1;s<l||c>d;){if(h=k[u++],s<l){m=n[s++];try{m[0]-=h*(m[0]-i)/S|0,m[1]-=h*(m[1]-r)/S|0,m[2]-=h*(m[2]-o)/S|0}catch(t){}}if(c>d){m=n[c--];try{m[0]-=h*(m[0]-i)/S|0,m[1]-=h*(m[1]-r)/S|0,m[2]-=h*(m[2]-o)/S|0}catch(t){}}}}function T(t,e,i,r,a){var o=n[e],s=t/E;o[0]-=s*(o[0]-i)|0,o[1]-=s*(o[1]-r)|0,o[2]-=s*(o[2]-a)|0}function L(t,e,i){var r,o,s,c,d,l,h,m,f,w;for(f=m=~(1<<31),h=l=-1,r=0;r<a;r++)(o=(w=n[r])[0]-t)<0&&(o=-o),(s=w[1]-e)<0&&(s=-s),o+=s,(s=w[2]-i)<0&&(s=-s),(o+=s)<m&&(m=o,l=r),(c=o-(D[r]>>g-u))<f&&(f=c,h=r),d=A[r]>>p,A[r]-=d,D[r]+=d<<v;return A[l]+=C,D[l]-=y,h}(function(t,o,s){var c,d;for(e=t,i=o,r=s,n=new Array(a),c=0;c<a;c++)n[c]=new Array(4),(d=n[c])[0]=d[1]=d[2]=(c<<u+8)/a|0,A[c]=f/a|0,D[c]=0}).apply(this,arguments);var M={map:function(t,e,i){var r,o,s,c,d,l,h;for(d=1e3,h=-1,o=(r=x[e])-1;r<a||o>=0;)r<a&&((s=(l=n[r])[1]-e)>=d?r=a:(r++,s<0&&(s=-s),(c=l[0]-t)<0&&(c=-c),(s+=c)<d&&((c=l[2]-i)<0&&(c=-c),(s+=c)<d&&(d=s,h=l[3])))),o>=0&&((s=e-(l=n[o])[1])>=d?o=-1:(o--,s<0&&(s=-s),(c=l[0]-t)<0&&(c=-c),(s+=c)<d&&((c=l[2]-i)<0&&(c=-c),(s+=c)<d&&(d=s,h=l[3]))));return h}};return M.process=function(){return function(){var n,a,h,g,f,v,p,C,y,S,x,D,A,M;for(i<l&&(r=1),t=30+(r-1)/3,D=e,A=0,M=i,S=(x=i/(3*r))/m|0,C=E,(p=(v=B)>>w)<=1&&(p=0),n=0;n<p;n++)k[n]=C*((p*p-n*n)*F/(p*p));for(y=i<l?3:i%o!=0?3*o:i%s!=0?3*s:i%c!=0?3*c:3*d,n=0;n<x;)if(T(C,a=L(h=(255&D[A+0])<<u,g=(255&D[A+1])<<u,f=(255&D[A+2])<<u),h,g,f),0!==p&&I(p,a,h,g,f),(A+=y)>=M&&(A-=i),0===S&&(S=1),++n%S==0)for(C-=C/t,(p=(v-=v/b)>>w)<=1&&(p=0),a=0;a<p;a++)k[a]=C*((p*p-a*a)*F/(p*p))}(),function(){var t;for(t=0;t<a;t++)n[t][0]>>=u,n[t][1]>>=u,n[t][2]>>=u,n[t][3]=t}(),function(){var t,e,i,r,o,s,c,d;for(c=0,d=0,t=0;t<a;t++){for(i=t,r=(o=n[t])[1],e=t+1;e<a;e++)(s=n[e])[1]<r&&(i=e,r=s[1]);if(s=n[i],t!=i&&(e=s[0],s[0]=o[0],o[0]=e,e=s[1],s[1]=o[1],o[1]=e,e=s[2],s[2]=o[2],o[2]=e,e=s[3],s[3]=o[3],o[3]=e),r!=c){for(x[c]=d+t>>1,e=c+1;e<r;e++)x[e]=t;c=r,d=t}}for(x[c]=d+h>>1,e=c+1;e<256;e++)x[e]=h}(),function(){for(var t=[],e=new Array(a),i=0;i<a;i++)e[n[i][3]]=i;for(var r=0,o=0;o<a;o++){var s=e[o];t[r++]=n[s][0],t[r++]=n[s][1],t[r++]=n[s][2]}return t}()},M}function p(){try{this.onmessage=function(e){var i,r=e.data||{};r.gifshot&&(i=t.run(r),postMessage(i))}}catch(t){}var t={dataToRGB:function(t,e,i){for(var r=e*i*4,n=0,a=[];n<r;)a.push(t[n++]),a.push(t[n++]),a.push(t[n++]),n++;return a},componentizedPaletteToArray:function(t){t=t||[];for(var e=[],i=0;i<t.length;i+=3){var r=t[i],n=t[i+1],a=t[i+2];e.push(r<<16|n<<8|a)}return e},processFrameWithQuantizer:function(t,e,i,r){for(var n=this.dataToRGB(t,e,i),a=new v(n,n.length,r),o=a.process(),s=new Uint32Array(this.componentizedPaletteToArray(o)),c=e*i,d=new Uint8Array(c),l=0,h=0;h<c;h++){var u=n[l++],m=n[l++],g=n[l++];d[h]=a.map(u,m,g)}return{pixels:d,palette:s}},run:function(t){var e=t=t||{},i=e.height,r=(e.palette,e.sampleInterval),n=e.width,a=t.data;return this.processFrameWithQuantizer(a,n,i,r)}};return t}function C(t,e,i,r){var n=0,a=(r=r===o?{}:r).loop===o?null:r.loop,s=r.palette===o?null:r.palette;if(e<=0||i<=0||e>65535||i>65535)throw"Width/Height invalid.";t[n++]=71,t[n++]=73,t[n++]=70,t[n++]=56,t[n++]=57,t[n++]=97;if(t[n++]=255&e,t[n++]=e>>8&255,t[n++]=255&i,t[n++]=i>>8&255,t[n++]=0|(null!==s?128:0),t[n++]=0,t[n++]=0,null!==a){if(a<0||a>65535)throw"Loop count invalid.";t[n++]=33,t[n++]=255,t[n++]=11,t[n++]=78,t[n++]=69,t[n++]=84,t[n++]=83,t[n++]=67,t[n++]=65,t[n++]=80,t[n++]=69,t[n++]=50,t[n++]=46,t[n++]=48,t[n++]=3,t[n++]=1,t[n++]=255&a,t[n++]=a>>8&255,t[n++]=0}var c=!1;this.addFrame=function(e,i,r,a,d,l){if(!0===c&&(--n,c=!1),l=l===o?{}:l,e<0||i<0||e>65535||i>65535)throw"x/y invalid.";if(r<=0||a<=0||r>65535||a>65535)throw"Width/Height invalid.";if(d.length<r*a)throw"Not enough pixels for the frame size.";var h=!0,u=l.palette;if(u!==o&&null!==u||(h=!1,u=s),u===o||null===u)throw"Must supply either a local or global palette.";for(var m=function(t){var e=t.length;if(e<2||e>256||e&e-1)throw"Invalid code/color length, must be power of 2 and 2 .. 256.";return e}(u),g=0;m>>=1;)++g;m=1<<g;var f=l.delay===o?0:l.delay,v=l.disposal===o?0:l.disposal;if(v<0||v>3)throw"Disposal out of range.";var p=!1,C=0;if(l.transparent!==o&&null!==l.transparent&&(p=!0,(C=l.transparent)<0||C>=m))throw"Transparent color index.";if((0!==v||p||0!==f)&&(t[n++]=33,t[n++]=249,t[n++]=4,t[n++]=v<<2|(!0===p?1:0),t[n++]=255&f,t[n++]=f>>8&255,t[n++]=C,t[n++]=0),t[n++]=44,t[n++]=255&e,t[n++]=e>>8&255,t[n++]=255&i,t[n++]=i>>8&255,t[n++]=255&r,t[n++]=r>>8&255,t[n++]=255&a,t[n++]=a>>8&255,t[n++]=!0===h?128|g-1:0,!0===h)for(var y=0,w=u.length;y<w;++y){var B=u[y];t[n++]=B>>16&255,t[n++]=B>>8&255,t[n++]=255&B}n=function(t,e,i,r){t[e++]=i;var n=e++,a=1<<i,s=a-1,c=a+1,d=c+1,l=i+1,h=0,u=0;function m(i){for(;h>=i;)t[e++]=255&u,u>>=8,h-=8,e===n+256&&(t[n]=255,n=e++)}function g(t){u|=t<<h,h+=l,m(8)}var f=r[0]&s,v={};g(a);for(var p=1,C=r.length;p<C;++p){var y=r[p]&s,w=f<<8|y,B=v[w];if(B===o){for(u|=f<<h,h+=l;h>=8;)t[e++]=255&u,u>>=8,h-=8,e===n+256&&(t[n]=255,n=e++);4096===d?(g(a),d=c+1,l=i+1,v={}):(d>=1<<l&&++l,v[w]=d++),f=y}else f=B}g(f),g(c),m(1),n+1===e?t[n]=0:(t[n]=e-n-1,t[e++]=0);return e}(t,n,g<2?2:g,d)},this.end=function(){return!1===c&&(t[n++]=59,c=!0),n}}var y=function(){},w=function(t){this.canvas=null,this.ctx=null,this.repeat=0,this.frames=[],this.numRenderedFrames=0,this.onRenderCompleteCallback=y,this.onRenderProgressCallback=y,this.workers=[],this.availableWorkers=[],this.generatingGIF=!1,this.options=t,this.initializeWebWorkers(t)};w.prototype={workerMethods:p(),initializeWebWorkers:function(t){var e,i=v.toString()+"("+p.toString()+"());",r=void 0,a=void 0,o=void 0,s=-1,d="";for(e=t.numWorkers;++s<e;)r=c.createWebWorker(i),c.isObject(r)?(a=r.objectUrl,o=r.worker,this.workers.push({worker:o,objectUrl:a}),this.availableWorkers.push(o)):(d=r,c.webWorkerError=!!r);this.workerError=d,this.canvas=n.createElement("canvas"),this.canvas.width=t.gifWidth,this.canvas.height=t.gifHeight,this.ctx=this.canvas.getContext("2d"),this.frames=[]},getWorker:function(){return this.availableWorkers.pop()},freeWorker:function(t){this.availableWorkers.push(t)},byteMap:function(){for(var t=[],e=0;e<256;e++)t[e]=String.fromCharCode(e);return t}(),bufferToString:function(t){for(var e=t.length,i="",r=-1;++r<e;)i+=this.byteMap[t[r]];return i},onFrameFinished:function(t){var e=this,i=e.frames,r=!!(e.options.images||[]).length,n=i.every(function(t){return!t.beingProcessed&&t.done});e.numRenderedFrames++,r&&t(e.numRenderedFrames/i.length),e.onRenderProgressCallback(.75*e.numRenderedFrames/i.length),n?e.generatingGIF||e.generateGIF(i,e.onRenderCompleteCallback):c.requestTimeout(function(){e.processNextFrame()},1)},processFrame:function(t){var e=this,i=(this.options,this.options),r=i.progressCallback,n=i.sampleInterval,a=this.frames,s=void 0,c=void 0,d=function(){var t=(arguments.length>0&&arguments[0]!==o?arguments[0]:{}).data;delete s.data,s.pixels=Array.prototype.slice.call(t.pixels),s.palette=Array.prototype.slice.call(t.palette),s.done=!0,s.beingProcessed=!1,e.freeWorker(c),e.onFrameFinished(r)};(s=a[t]).beingProcessed||s.done?this.onFrameFinished():(s.sampleInterval=n,s.beingProcessed=!0,s.gifshot=!0,(c=this.getWorker())?(c.onmessage=d,c.postMessage(s)):d({data:e.workerMethods.run(s)}))},startRendering:function(t){this.onRenderCompleteCallback=t;for(var e=0;e<this.options.numWorkers&&e<this.frames.length;e++)this.processFrame(e)},processNextFrame:function(){for(var t=-1,e=0;e<this.frames.length;e++){var i=this.frames[e];if(!i.done&&!i.beingProcessed){t=e;break}}t>=0&&this.processFrame(t)},generateGIF:function(t,e){var i=[],r={loop:this.repeat},n=this.options,a=n.interval,o=n.frameDuration,s=!!n.images.length,d=n.gifHeight,l=n.gifWidth,h=new C(i,l,d,r),u=this.onRenderProgressCallback,m=s?100*a:0,g=void 0;this.generatingGIF=!0,c.each(t,function(e,i){var r=i.palette;u(.75+.25*i.position*1/t.length);for(var n=0;n<o;n++)h.addFrame(0,0,l,d,i.pixels,{palette:r,delay:m})}),h.end(),u(1),this.frames=[],this.generatingGIF=!1,c.isFunction(e)&&(g=this.bufferToString(i),e("data:image/gif;base64,"+c.btoa(g)))},setRepeat:function(t){this.repeat=t},addFrame:function(t,e,i){e=c.isObject(e)?e:{};var r=this.ctx,n=this.options,a=n.gifWidth,o=n.gifHeight,s=c.getFontSize(e),d=e,l=d.filter,h=d.fontColor,u=d.fontFamily,m=d.fontWeight,g=(d.gifHeight,d.gifWidth,d.text),f=d.textAlign,v=d.textBaseline,p=d.waterMark,C=d.waterMarkHeight,y=d.waterMarkWidth,w=d.waterMarkXCoordinate,B=d.waterMarkYCoordinate,b=e.textXCoordinate?e.textXCoordinate:"left"===f?1:"right"===f?a:a/2,E=e.textYCoordinate?e.textYCoordinate:"top"===v?1:"center"===v?o/2:o,F=m+" "+s+" "+u,S=i&&e.showFrameText?i:g,x=void 0;try{r.filter=l,r.drawImage(t,0,0,a,o),S&&(r.font=F,r.fillStyle=h,r.textAlign=f,r.textBaseline=v,r.fillText(S,b,E)),p&&r.drawImage(p,w,B,y,C),x=r.getImageData(0,0,a,o),this.addFrameImageData(x)}catch(t){return""+t}},addFrameImageData:function(){var t=arguments.length>0&&arguments[0]!==o?arguments[0]:{},e=this.frames,i=t.data;this.frames.push({data:i,width:t.width,height:t.height,palette:null,dithering:null,done:!1,beingProcessed:!1,position:e.length})},onRenderProgress:function(t){this.onRenderProgressCallback=t},isRendering:function(){return this.generatingGIF},getBase64GIF:function(t){var e=this;e.startRendering(function(i){e.destroyWorkers(),c.requestTimeout(function(){t(i)},0)})},destroyWorkers:function(){if(!this.workerError){var t=this.workers;c.each(t,function(t,e){var i=e.worker,r=e.objectUrl;i.terminate(),c.URL.revokeObjectURL(r)})}}};var B=function(){},b={getGIF:function(){var t=arguments.length>0&&arguments[0]!==o?arguments[0]:{},e=arguments[1];e=c.isFunction(e)?e:B;var i=n.createElement("canvas"),r=void 0,a=!!t.images.length,s=t.cameraStream,d=t.crop,l=t.filter,h=t.fontColor,u=t.fontFamily,m=t.fontWeight,g=t.keepCameraOn,f=(t.numWorkers,t.progressCallback),v=t.saveRenderingContexts,p=t.savedRenderingContexts,C=t.text,y=t.textAlign,b=t.textBaseline,E=t.videoElement,F=t.videoHeight,S=t.videoWidth,x=t.webcamVideoElement,D=t.waterMark,A=t.waterMarkHeight,k=t.waterMarkWidth,I=t.waterMarkXCoordinate,T=t.waterMarkYCoordinate,L=Number(t.gifWidth),M=Number(t.gifHeight),P=Number(t.interval),z=(Number(t.sampleInterval),a?0:1e3*P),R=[],O=p.length?p.length:t.numFrames,U=O,W=new w(t),q=c.getFontSize(t),H=t.textXCoordinate?t.textXCoordinate:"left"===y?1:"right"===y?L:L/2,j=t.textYCoordinate?t.textYCoordinate:"top"===b?1:"center"===b?M/2:M,V=m+" "+q+" "+u,N=d?Math.floor(d.scaledWidth/2):0,$=d?S-d.scaledWidth:0,G=d?Math.floor(d.scaledHeight/2):0,X=d?F-d.scaledHeight:0;O=O!==o?O:10,P=P!==o?P:.1,i.width=L,i.height=M,r=i.getContext("2d"),function t(){p.length||0!==E.currentTime?function t(){var i=U-1;function n(){var n;v&&R.push(r.getImageData(0,0,L,M)),D&&r.drawImage(D,I,T,k,A),C&&(r.font=V,r.fillStyle=h,r.textAlign=y,r.textBaseline=b,r.fillText(C,H,j)),n=r.getImageData(0,0,L,M),W.addFrameImageData(n),f((O-(U=i))/O),i>0&&c.requestTimeout(t,z),U||W.getBase64GIF(function(t){e({error:!1,errorCode:"",errorMsg:"",image:t,cameraStream:s,videoElement:E,webcamVideoElement:x,savedRenderingContexts:R,keepCameraOn:g})})}p.length?(r.putImageData(p[O-U],0,0),n()):function t(){try{$>S&&($=S),X>F&&(X=F),N<0&&(N=0),G<0&&(G=0),r.filter=l,r.drawImage(E,N,G,$,X,0,0,L,M),n()}catch(e){if("NS_ERROR_NOT_AVAILABLE"!==e.name)throw e;c.requestTimeout(t,100)}}()}():c.requestTimeout(t,100)}()},getCropDimensions:function(){var t=arguments.length>0&&arguments[0]!==o?arguments[0]:{},e=t.videoWidth,i=t.videoHeight,r=t.gifWidth,n=t.gifHeight,a={width:0,height:0,scaledWidth:0,scaledHeight:0};return e>i?(a.width=Math.round(e*(n/i))-r,a.scaledWidth=Math.round(a.width*(i/n))):(a.height=Math.round(i*(r/e))-n,a.scaledHeight=Math.round(a.height*(e/r))),a}},E={loadedData:!1,defaultVideoDimensions:{width:640,height:480},findVideoSize:function t(e){t.attempts=t.attempts||0;var i=e.cameraStream,r=e.completedCallback,n=e.videoElement;n&&(n.videoWidth>0&&n.videoHeight>0?(n.removeEventListener("loadeddata",E.findVideoSize),r({videoElement:n,cameraStream:i,videoWidth:n.videoWidth,videoHeight:n.videoHeight})):t.attempts<10?(t.attempts+=1,c.requestTimeout(function(){E.findVideoSize(e)},400)):r({videoElement:n,cameraStream:i,videoWidth:E.defaultVideoDimensions.width,videoHeight:E.defaultVideoDimensions.height}))},onStreamingTimeout:function(t){c.isFunction(t)&&t({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - Timed out while trying to start streaming",image:null,cameraStream:{}})},stream:function(t){var e=c.isArray(t.existingVideo)?t.existingVideo[0]:t.existingVideo,i=t.cameraStream,r=t.completedCallback,n=t.streamedCallback,a=t.videoElement;if(c.isFunction(n)&&n(),e){if(c.isString(e))a.src=e,a.innerHTML='<source src="'+e+'" type="video/'+c.getExtension(e)+'" />';else if(e instanceof Blob){try{a.src=c.URL.createObjectURL(e)}catch(t){}a.innerHTML='<source src="'+e+'" type="'+e.type+'" />'}}else if(a.mozSrcObject)a.mozSrcObject=i;else if(c.URL)try{a.srcObject=i,a.src=c.URL.createObjectURL(i)}catch(t){a.srcObject=i}a.play(),c.requestTimeout(function t(){t.count=t.count||0,!0===E.loadedData?(E.findVideoSize({videoElement:a,cameraStream:i,completedCallback:r}),E.loadedData=!1):(t.count+=1)>10?E.findVideoSize({videoElement:a,cameraStream:i,completedCallback:r}):t()},0)},startStreaming:function(t){var e=c.isFunction(t.error)?t.error:c.noop,i=c.isFunction(t.streamed)?t.streamed:c.noop,r=c.isFunction(t.completed)?t.completed:c.noop,a=t.crossOrigin,o=t.existingVideo,s=t.lastCameraStream,d=t.options,l=t.webcamVideoElement,h=c.isElement(o)?o:l||n.createElement("video");a&&(h.crossOrigin=d.crossOrigin),h.autoplay=!0,h.loop=!0,h.muted=!0,h.addEventListener("loadeddata",function(t){E.loadedData=!0,d.offset&&(h.currentTime=d.offset)}),o?E.stream({videoElement:h,existingVideo:o,completedCallback:r}):s?E.stream({videoElement:h,cameraStream:s,streamedCallback:i,completedCallback:r}):c.getUserMedia({video:!0},function(t){E.stream({videoElement:h,cameraStream:t,streamedCallback:i,completedCallback:r})},e)},startVideoStreaming:function(t){var e=arguments.length>1&&arguments[1]!==o?arguments[1]:{},i=e.timeout!==o?e.timeout:0,r=e.callback,n=e.webcamVideoElement,a=void 0;i>0&&(a=c.requestTimeout(function(){E.onStreamingTimeout(r)},1e4)),E.startStreaming({error:function(){r({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - the user probably denied permission",image:null,cameraStream:{}})},streamed:function(){clearTimeout(a)},completed:function(){var e=arguments.length>0&&arguments[0]!==o?arguments[0]:{},i=e.cameraStream,r=e.videoElement,n=e.videoHeight,a=e.videoWidth;t({cameraStream:i,videoElement:r,videoHeight:n,videoWidth:a})},lastCameraStream:e.lastCameraStream,webcamVideoElement:n,crossOrigin:e.crossOrigin,options:e})},stopVideoStreaming:function(t){var e=t=c.isObject(t)?t:{},i=e.keepCameraOn,r=e.videoElement,n=e.webcamVideoElement,a=t.cameraStream||{},o=a.getTracks&&a.getTracks()||[],s=!!o.length,d=o[0];!i&&s&&c.isFunction(d.stop)&&d.stop(),c.isElement(r)&&!n&&(r.pause(),c.isFunction(c.URL.revokeObjectURL)&&!c.webWorkerError&&r.src&&c.URL.revokeObjectURL(r.src),c.removeElement(r))}};function F(t){t=c.isObject(t)?t:{},E.stopVideoStreaming(t)}function S(t,e){var i=t.options||{},r=i.images,a=i.video,o=Number(i.gifWidth),s=Number(i.gifHeight),d=(Number(i.numFrames),t.cameraStream),l=t.videoElement,h=t.videoWidth,u=t.videoHeight,m=b.getCropDimensions({videoWidth:h,videoHeight:u,gifHeight:s,gifWidth:o}),g=e;i.crop=m,i.videoElement=l,i.videoWidth=h,i.videoHeight=u,i.cameraStream=d,c.isElement(l)&&(l.width=o+m.width,l.height=s+m.height,i.webcamVideoElement||(c.setCSSAttr(l,{position:"fixed",opacity:"0"}),n.body.appendChild(l)),l.play(),b.getGIF(i,function(t){r&&r.length||a&&a.length||F(t),g(t)}))}function x(t,e){if(e=c.isFunction(t)?t:e,t=c.isObject(t)?t:{},c.isFunction(e)){var i=c.mergeOptions(m,t)||{},r=t.cameraStream,a=i.images,s=a?a.length:0,d=i.video,h=i.webcamVideoElement;i=c.mergeOptions(i,{gifWidth:Math.floor(i.gifWidth),gifHeight:Math.floor(i.gifHeight)}),s?function(){var t=arguments.length>0&&arguments[0]!==o?arguments[0]:{},e=t.callback,i=t.images,r=t.options,a=t.imagesLength,s=l.validate({getUserMedia:!0,"window.URL":!0}),d=[],h=0,u=void 0,m=void 0;if(s.error)return e(s);function g(){c.each(d,function(t,e){e&&(e.text?m.addFrame(e.img,r,e.text):m.addFrame(e,r))}),function(t,e){t.getBase64GIF(function(t){e({error:!1,errorCode:"",errorMsg:"",image:t})})}(m,e)}m=new w(r),c.each(i,function(t,i){var o=i;i.src&&(o=o.src),c.isElement(o)?(r.crossOrigin&&(o.crossOrigin=r.crossOrigin),d[t]=o,(h+=1)===a&&g()):c.isString(o)&&(u=new Image,r.crossOrigin&&(u.crossOrigin=r.crossOrigin),function(r){i.text&&(r.text=i.text),r.onerror=function(t){var i=void 0;if(0==--a)return(i={}).error="None of the requested images was capable of being retrieved",e(i)},r.onload=function(e){i.text?d[t]={img:r,text:r.text}:d[t]=r,(h+=1)===a&&g(),c.removeElement(r)},r.src=o}(u),c.setCSSAttr(u,{position:"fixed",opacity:"0"}),n.body.appendChild(u))})}({images:a,imagesLength:s,callback:e,options:i}):d?function(){var t=arguments.length>0&&arguments[0]!==o?arguments[0]:{},e=t.callback,i=t.existingVideo,r=t.options,n=l.validate({getUserMedia:!0,"window.URL":!0}),a=void 0,s=void 0;if(n.error)return e(n);if(c.isElement(i)&&i.src){if(s=i.src,a=c.getExtension(s),!c.isSupported.videoCodecs[a])return e(l.messages.videoCodecs)}else c.isArray(i)&&c.each(i,function(t,e){if(a=e instanceof Blob?e.type.substr(e.type.lastIndexOf("/")+1,e.length):e.substr(e.lastIndexOf(".")+1,e.length),c.isSupported.videoCodecs[a])return i=e,!1});E.startStreaming({completed:function(t){t.options=r||{},S(t,e)},existingVideo:i,crossOrigin:r.crossOrigin,options:r})}({existingVideo:d,callback:e,options:i}):function(){var t=arguments.length>0&&arguments[0]!==o?arguments[0]:{},e=t.callback,i=t.lastCameraStream,r=t.options,n=t.webcamVideoElement;if(!f())return e(l.validate());r.savedRenderingContexts.length?b.getGIF(r,function(t){e(t)}):E.startVideoStreaming(function(){var t=arguments.length>0&&arguments[0]!==o?arguments[0]:{};t.options=r||{},S(t,e)},{lastCameraStream:i,callback:e,webcamVideoElement:n,crossOrigin:r.crossOrigin})}({lastCameraStream:r,callback:e,webcamVideoElement:h,options:i})}}var D={utils:d,error:h,defaultOptions:g,createGIF:x,takeSnapShot:function(t,e){if(e=c.isFunction(t)?t:e,t=c.isObject(t)?t:{},c.isFunction(e)){var i=c.mergeOptions(m,t);x(c.mergeOptions(i,{interval:.1,numFrames:1,gifWidth:Math.floor(i.gifWidth),gifHeight:Math.floor(i.gifHeight)}),e)}},stopVideoStreaming:F,isSupported:function(){return l.isValid()},isWebCamGIFSupported:f,isExistingVideoGIFSupported:function(t){var e=!1;if(c.isArray(t)&&t.length){if(c.each(t,function(t,i){c.isSupported.videoCodecs[i]&&(e=!0)}),!e)return!1}else if(c.isString(t)&&t.length&&!c.isSupported.videoCodecs[t])return!1;return l.isValid({getUserMedia:!0})},isExistingImagesGIFSupported:function(){return l.isValid({getUserMedia:!0})},VERSION:"0.4.5"};(r=function(){return D}.apply(e,[]))===o||(t.exports=r)}("undefined"!=typeof window?window:{},"undefined"!=typeof document?document:{createElement:function(){}},"undefined"!=typeof window?window.navigator:{})},function(t,e,i){"use strict";class r{constructor(t){let e=t,i=1;this.setScale=t=>{i=t},this.getScale=()=>i;let r=32;this.setCanvasSize=t=>{r=t},this.getCanvasSize=()=>r;let n=32;this.setPenSize=t=>{n=t},this.getPenSize=()=>n,this.setState=t=>{e=t},this.getState=()=>e}lineCoordinates(t,e,i,r,n=0){let a,o,s,c,d;const l=i-t,h=r-e,u=Math.abs(l),m=Math.abs(h);let g=2*m-u,f=2*u-m;if(m<=u)for(l>=0?(a=t,o=e,s=i):(a=i,o=r,s=t),this.drawPixel(a,o,n),d=0;a<s;d+=1)a+=this.getPenSize(),g<0?g+=2*m:(o=this.nextPixel(l,h,o),g+=2*(m-u)),this.drawPixel(a,o,n);else for(h>=0?(a=t,o=e,c=r):(a=i,o=r,c=e),this.drawPixel(a,o,n),d=0;o<c;d+=1)o+=this.getPenSize(),f<=0?f+=2*u:(a=this.nextPixel(l,h,a),f+=2*(u-m)),this.drawPixel(a,o,n)}nextPixel(t,e,i){let r=i;return t<0&&e<0||t>0&&e>0?r+=this.getPenSize():r-=this.getPenSize(),r}drawPixel(t,e,i){if(i){const n=`${r.lighten(document.getElementById("canvas").getContext("2d").getImageData(t,e,1,1).data,.1*i)}`;document.getElementById("canvas").getContext("2d").fillStyle="1111"!==n?n:"transparent"}document.getElementById("canvas").getContext("2d").fillRect(t,e,this.getPenSize(),this.getPenSize())}drawCircle(t,e,i,r){const n=Math.sqrt((e-r)**2+(t-i)**2)/2,a=(t+i)/2,o=(e+r)/2;let s=-n,c=0,d=1-n;do{this.setPixel(a,o,s,c),d+c>0&&(d+=(s+=this.getPenSize())*this.getPenSize()*2+this.getPenSize()),d+s<=0&&(d+=(c+=this.getPenSize())*this.getPenSize()*2+this.getPenSize())}while(s<0);document.getElementById("canvas").getContext("2d").fillRect(a,o-c,this.getPenSize(),this.getPenSize()),document.getElementById("canvas").getContext("2d").fillRect(a,o+c,this.getPenSize(),this.getPenSize())}setPixel(t,e,i,r){const n=t,a=e,o=i,s=r;document.getElementById("canvas").getContext("2d").fillRect(n-o,a+s,this.getPenSize(),this.getPenSize()),document.getElementById("canvas").getContext("2d").fillRect(n-o,a-s,this.getPenSize(),this.getPenSize()),document.getElementById("canvas").getContext("2d").fillRect(n+o,a-s,this.getPenSize(),this.getPenSize()),document.getElementById("canvas").getContext("2d").fillRect(n+o,a+s,this.getPenSize(),this.getPenSize())}static lighten(t,e){if(0===t[3])return"1111";let i=t[0],r=t[1],n=t[2];return e>0?(i=(1-e)*i+255*e,r=(1-e)*r+255*e,n=(1-e)*n+255*e):(i*=1+e/4,r*=1+e/4,n*=1+e/4),`rgb(${i}, ${r}, ${n})`}}class n{constructor(t){this.canvas=t}clearCanvas(){this.canvas.context.clearRect(0,0,this.canvas.width,this.canvas.height)}redrawCanvas(t){this.clearCanvas(),this.canvas.context.imageSmoothingEnabled=!1,this.canvas.context.webkitImageSmoothingEnabled=!1,this.canvas.context.drawImage(t,0,0,t.width,t.height,0,0,832,832)}}class a{constructor(t,e){this.canvas=e,this.model=t,this.img=new Image,this.drawingState=!1,this.Canvasview=new n(e),this.startCoord={},this.shift=!1,this.ctrl=!1,this.curr={},this.numCoord=document.getElementById("numCoord"),this.left=!1}startDrawing(t){this.startCoord=this.getCoordinates(t),this.checkChangingColor(),this.checkMovingState(),!0!==this.curr.move&&"undefined"!==this.curr.x&&(this.drawingState=!0,this.img.src=this.canvas.canvas.toDataURL()),"paintSame"===this.model.getState()&&this.paintSameColor(),"bucket"===this.model.getState()&&this.bucket(),"picker"===this.model.getState()&&this.pickerTool()}checkMovingState(){this.startCoord.x>this.curr.x&&this.startCoord.x<this.curr.x+this.curr.width&&this.startCoord.y>this.curr.y&&this.startCoord.y<this.curr.y+this.curr.height&&"shape"===this.model.getState()?this.curr.move=!0:((this.startCoord.x>this.curr.x+this.curr.width||this.startCoord.x<this.curr.x)&&"shape"===this.model.getState()||(this.startCoord.y>this.curr.y+this.curr.height||this.startCoord.y<this.curr.y)&&"shape"===this.model.getState())&&(this.Canvasview.redrawCanvas(this.img,this.model.getScale()),this.curr={}),!0===this.curr.move&&(this.curr.moveX=Math.abs(this.curr.x-this.startCoord.x),this.curr.moveY=Math.abs(this.curr.y-this.startCoord.y),this.drawingState=!0)}checkChangingColor(){this.left?this.changeColor(0):this.changeColor(1)}getCoordinates(t){const e=document.getElementById("canvas").getBoundingClientRect();return{x:Math.round((t.clientX-e.left-1.25)/this.model.getPenSize())*this.model.getPenSize(),y:Math.round((t.clientY-e.top-1.25)/this.model.getPenSize())*this.model.getPenSize()}}penDrawing(t,e){this.model.lineCoordinates(this.startCoord.x,this.startCoord.y,t,e),this.startCoord.x=t,this.startCoord.y=e}lineDrawing(t,e){this.Canvasview.redrawCanvas(this.img),this.model.lineCoordinates(this.startCoord.x,this.startCoord.y,t,e)}drawRectangle(t,e){this.Canvasview.redrawCanvas(this.img),this.drawCarcass(t,e),this.canvas.context.stroke()}drawCarcass(t,e){this.canvas.context.lineWidth=this.model.getPenSize(),this.canvas.context.beginPath(),this.canvas.context.moveTo(this.startCoord.x,this.startCoord.y),this.startCoord.x<t&&this.startCoord.y>e?(this.canvas.context.lineTo(t,this.startCoord.y),this.canvas.context.lineTo(t,e),this.canvas.context.lineTo(this.startCoord.x,e),this.canvas.context.lineTo(this.startCoord.x,this.startCoord.y)):this.startCoord.x>t&&this.startCoord.y<e?(this.canvas.context.lineTo(t,this.startCoord.y),this.canvas.context.lineTo(t,e),this.canvas.context.lineTo(this.startCoord.x,e),this.canvas.context.lineTo(this.startCoord.x,this.startCoord.y)):this.startCoord.x<t&&this.startCoord.y<e?(this.canvas.context.lineTo(this.startCoord.x,e),this.canvas.context.lineTo(t,e),this.canvas.context.lineTo(t,this.startCoord.y),this.canvas.context.lineTo(this.startCoord.x,this.startCoord.y)):this.startCoord.x>t&&this.startCoord.y>e&&(this.canvas.context.lineTo(this.startCoord.x,e),this.canvas.context.lineTo(t,e),this.canvas.context.lineTo(t,this.startCoord.y),this.canvas.context.lineTo(this.startCoord.x,this.startCoord.y)),this.canvas.context.closePath()}moveTool(t,e){this.canvas.context.save(),this.canvas.context.translate(t-this.startCoord.x,e-this.startCoord.y),this.Canvasview.redrawCanvas(this.img),this.canvas.context.restore()}eraserTool(t,e){this.canvas.context.globalCompositeOperation="destination-out",this.canvas.context.fillStyle="(rgba(0,0,0,1)",this.penDrawing(t,e),this.canvas.context.globalCompositeOperation="source-over"}pickerTool(){const t=this.canvas.context.getImageData(this.startCoord.x,this.startCoord.y,1,1).data;0!==t[3]&&(document.getElementById("rightBut").value=`#${a.NumToHEX(t[0])}${a.NumToHEX(t[1])}${a.NumToHEX(t[2])}`)}bucket(){const t=document.getElementById("rightBut").value;this.floodFill(this.startCoord.x,this.startCoord.y,t)}drawCircle(t,e){this.Canvasview.redrawCanvas(this.img,this.model.getScale()),this.model.drawCircle(this.startCoord.x,this.startCoord.y,t,e)}darkenLightenTool(t,e){this.shift?this.model.lineCoordinates(this.startCoord.x,this.startCoord.y,t,e,-1):this.model.lineCoordinates(this.startCoord.x,this.startCoord.y,t,e,1),this.startCoord.x=t,this.startCoord.y=e}shapeTool(t,e){this.Canvasview.redrawCanvas(this.img,this.model.getScale()),(void 0===this.curr.move||!1===this.curr.move&&void 0!==this.curr.move)&&(this.canvas.context.fillStyle="#00FFFF33",this.drawCarcass(t,e),this.canvas.context.fill(),this.curr.x=Math.min(t,this.startCoord.x),this.curr.y=Math.min(e,this.startCoord.y),this.curr.width=Math.abs(this.startCoord.x-t),this.curr.height=Math.abs(this.startCoord.y-e),this.curr.move=!1),void 0!==this.curr.move&&!0===this.curr.move&&(this.Canvasview.redrawCanvas(this.img,this.model.getScale()),this.canvas.context.save(),this.canvas.context.translate(t-this.curr.moveX,e-this.curr.moveY),this.canvas.context.fillRect(0,0,this.curr.width,this.curr.height),this.canvas.context.restore(),this.curr.x=t-this.curr.moveX,this.curr.y=e-this.curr.moveY)}mirrorTool(t,e){this.shift||this.ctrl?this.shift&&!this.ctrl?(this.model.lineCoordinates(this.startCoord.x,this.startCoord.y,t,e),this.model.lineCoordinates(this.startCoord.x,this.canvas.height-this.startCoord.y,t,this.canvas.height-e)):!this.shift&&this.ctrl&&(this.model.lineCoordinates(this.startCoord.x,this.startCoord.y,t,e),this.model.lineCoordinates(this.canvas.width-this.startCoord.x,this.canvas.height-this.startCoord.y,this.canvas.width-t,this.canvas.height-e),this.model.lineCoordinates(this.canvas.width-this.startCoord.x,this.startCoord.y,this.canvas.width-t,e),this.model.lineCoordinates(this.startCoord.x,this.canvas.height-this.startCoord.y,t,this.canvas.height-e)):(this.model.lineCoordinates(this.startCoord.x,this.startCoord.y,t,e),this.model.lineCoordinates(this.canvas.width-this.startCoord.x,this.startCoord.y,this.canvas.width-t,e)),this.startCoord.x=t-this.curr.moveX,this.startCoord.y=e-this.curr.moveY}draw(t){const e=this.getCoordinates(t);if(this.drawingState){if(void 0===this.startCoord.x&&(this.startCoord=e),"pen"===this.model.getState())return this.penDrawing(e.x,e.y),!0;if("line"===this.model.getState())return this.lineDrawing(e.x,e.y),!0;if("rectangle"===this.model.getState())return this.drawRectangle(e.x,e.y),!0;if("move"===this.model.getState())return this.moveTool(e.x,e.y),!0;if("eraser"===this.model.getState())return this.eraserTool(e.x,e.y),!0;if("circle"===this.model.getState())return this.drawCircle(e.x,e.y),!0;if("lighten"===this.model.getState())return this.darkenLightenTool(e.x,e.y);if("shape"===this.model.getState())return this.shapeTool(e.x,e.y),!0;if("mirror"===this.model.getState())return this.mirrorTool(e.x,e.y),!0}return this.numCoord.innerHTML=`[${e.x} : ${e.y}]`,!1}stopDrawing(){this.drawingState&&(this.startCoord={},this.drawingState=!1,this.left=!1)}mouseOut(){this.numCoord.style.visibility="hidden"}mouseEnter(){this.numCoord.style.visibility="visible"}deleteSelection(){"shape"===this.model.getState()&&(this.canvas.context.clearRect(this.curr.x,this.curr.y,this.curr.width,this.curr.height),this.img.src=this.canvas.canvas.toDataURL(),this.img.onload=()=>{this.canvas.context.fillStyle="#00FFFF33",this.canvas.context.fillRect(this.curr.x,this.curr.y,this.curr.width,this.curr.height)})}static getPixel(t,e,i){if(e<0||i<0||e>=t.width||i>=t.height)return[-1,-1,-1,-1];const r=4*(i*t.width+e);return t.data.slice(r,r+4)}floodFill(t,e,i){const r=this.canvas.context.getImageData(0,0,this.canvas.width,this.canvas.height),n={width:r.width,height:r.height,data:r.data},o=a.HextoRGB(i),s=a.getPixel(n,t,e);if(!a.sameColors(o,s)){const i=[t,e];for(;i.length>0;){const t=i.pop(),e=i.pop();a.sameColors(a.getPixel(n,e,t),s)&&(a.PaintPiskel(n,e,t,o),i.push(e+1,t),i.push(e-1,t),i.push(e,t+1),i.push(e,t-1))}this.canvas.context.putImageData(r,0,0)}}static PaintPiskel(t,e,i,r){const n=4*(i*t.width+e),a=t;a.data[n]=r[0],a.data[n+1]=r[1],a.data[n+2]=r[2],a.data[n+3]=255}static NumToHEX(t){const e=t.toString(16);return 1===e.length?`0${e}`:e}static HextoRGB(t){const e=[];return 0===t.slice(1,3)?e.push(0):e.push(parseInt(t.slice(1,3),16)),0==+t.slice(3,5)?e.push(0):e.push(parseInt(t.slice(3,5),16)),0==+t.slice(5,7)?e.push(0):e.push(parseInt(t.slice(5,7),16)),e}static sameColors(t,e,i=0){return t[0]===e[i]&&t[1]===e[i+1]&&t[2]===e[i+2]}paintSameColor(){const t=this.canvas.context.getImageData(0,0,this.canvas.width,this.canvas.height),e=document.getElementById("rightBut").value,i=a.HextoRGB(e),r={width:t.width,height:t.height,data:t.data},n=this.canvas.context.getImageData(this.startCoord.x,this.startCoord.y,1,1),{data:o}=n;for(let t=0;t<r.data.length;t+=4)a.sameColors(o,r.data,t)&&(r.data[t]=i[0],r.data[t+1]=i[1],r.data[t+2]=i[2]);this.canvas.context.putImageData(t,0,0)}changeColor(t){1===t?(this.canvas.context.strokeStyle=`${document.getElementById("rightBut").value}`,this.canvas.context.fillStyle=`${document.getElementById("rightBut").value}`):(this.canvas.context.strokeStyle=`${document.getElementById("leftBut").value}`,this.canvas.context.fillStyle=`${document.getElementById("leftBut").value}`)}static replaceColor(){const t=document.getElementById("rightBut").value,e=document.getElementById("leftBut").value;document.getElementById("leftBut").value=t,document.getElementById("rightBut").value=e,this.canvas.context.fillStyle=e}drawing(){document.getElementById("canvas").addEventListener("mousedown",t=>{this.startDrawing(t)},!1),document.getElementById("canvas").addEventListener("mousemove",t=>this.draw(t),!1),document.getElementById("canvas").addEventListener("mouseup",t=>this.stopDrawing(t),!1),document.getElementById("canvas").addEventListener("mouseleave",t=>this.mouseOut(t),!1),document.getElementById("canvas").addEventListener("mouseenter",t=>this.mouseEnter(t),!1)}redrawCanvas(t,e=0,i=0){return this.Canvasview.redrawCanvas(t,e,i)}clearCanvas(){return this.Canvasview.clearCanvas()}}class o{constructor(t=null){let e=t;this.setCurrentFrame=t=>{e=t},this.getCurrentFrame=()=>e}}class s{constructor(t){this.FrameList=t}static clearFrame(t){t.getContext("2d").clearRect(0,0,t.width,t.height)}static redrawFrame(t,e){s.clearFrame(t),t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height)}CreateFrame(t){const e=[],i=document.createElement("li");e.push(i);const r=document.createElement("div");r.id="num",r.innerText=`${t}`,i.appendChild(r);const n=document.createElement("canvas");n.id="frame",n.dataset.number=`${t}`,i.appendChild(n),n.setAttribute("draggable",!0),e.push(n),e.push(s.createButton("delete","../image/remove.png")),e.push(s.createButton("copy","../image/copy.png")),e.push(s.createButton("move","../image/move.png"));for(let t=2;t<e.length;t+=1)i.appendChild(e[t]);return this.addToList(i),e}static createButton(t,e){const i=document.createElement("button");return i.id=t,i.innerHTML=`<img src=${e}>`,i}addToList(t){this.FrameList.appendChild(t)}}class c{constructor(t,e){this.canvas=t,this.frameList=document.getElementById("frames"),this.FrameView=new s(this.frameList),this.CanvasController=e,this.frames=document.querySelectorAll("#frame"),this.FrameModel=new o(this.frames[0]),this.FramesCount=1,this.draggable=null}addFrameListeners(){this.canvas.canvas.addEventListener("mouseup",()=>{this.beginRender()}),this.addButtonListeners();const t=document.querySelectorAll("#frames li");t[0].querySelector("#copy").addEventListener("click",()=>{this.copyFrame(t[0],t[0].querySelector("canvas"))}),t[0].querySelector("#delete").addEventListener("click",()=>{this.removeFrame(t[0],t[0].querySelector("canvas"))}),this.activeFrame(),this.addClickFrame(),c.HiddenButton()}setDraggable(){const t=document.querySelectorAll("#frame");for(let e=0;e<t.length;e+=1)t[e].addEventListener("dragstart",t=>this.dragStart(t),!1),t[e].addEventListener("dragEnd",t=>c.dragEnd(t),!1),t[e].addEventListener("dragover",c.dragOver),t[e].addEventListener("dragenter",c.dragEnter),t[e].addEventListener("dragleave",t=>c.dragLeave(t)),t[e].addEventListener("drop",t=>this.dragDrop(t),!1)}dragStart(t){this.draggable=t.target}static dragEnter(t){const e=t;e.preventDefault(),e.target.style.opacity=".5",e.target.style.borderStyle="dashed",e.target.style.borderColor="gold"}static dragLeave(t){const e=t;e.target.style.borderStyle="dashed",e.target.style.borderColor="gold"}static dragOver(t){t.preventDefault()}dragDrop(t){const e=t;e.preventDefault(),this.draggable.style.borderStyle="solid",this.draggable.style.opacity="1",e.target.style.borderStyle="solid",e.target.style.opacity="1";const i=c.CreateImage(this.draggable.toDataURL());s.redrawFrame(this.draggable,t.target),i.onload=()=>{s.redrawFrame(t.target,i),this.CanvasController.redrawCanvas(i),this.FrameModel.setCurrentFrame(t.target),this.activeFrame()}}addClickFrame(){const t=document.querySelectorAll("#frame");for(let e=0;e<t.length;e+=1)t[e].addEventListener("click",()=>{this.FrameModel.setCurrentFrame(t[e]),this.activeFrame();const i=c.CreateImage(t[e].toDataURL());i.onload=()=>{this.CanvasController.redrawCanvas(i)}})}static CreateImage(t){const e=new Image;return e.src=t,e}activeFrame(){const t=document.querySelectorAll("#frame");for(let e=0;e<t.length;e+=1)t[e].style.borderColor="transparent";this.FrameModel.getCurrentFrame().style.borderColor="gold"}addButtonListeners(){document.getElementById("add").addEventListener("click",()=>{this.addFrame()})}addFrame(){this.CanvasController.clearCanvas(),this.FramesCount+=1;const t=this.FrameView.CreateFrame(this.FramesCount);t[2].addEventListener("click",()=>this.removeFrame(t[0],t[1])),t[3].addEventListener("click",()=>this.copyFrame(t[0],t[1])),this.FrameModel.setCurrentFrame(t[1]),c.HiddenButton(),this.activeFrame(),this.addClickFrame(),this.setDraggable()}removeFrame(t,e){const i=e;this.frameList.removeChild(t),this.FramesCount-=1,1==+i.dataset.number?this.FrameModel.setCurrentFrame(c.getDatasetFrame(+e.dataset.number+1)):this.FrameModel.setCurrentFrame(c.getDatasetFrame(+e.dataset.number-1)),this.activeFrame(),this.setFramesNumber(+e.dataset.number-1),this.CanvasController.redrawCanvas(this.FrameModel.getCurrentFrame()),this.addClickFrame(),c.HiddenButton()}copyFrame(t,e){this.FramesCount+=1;const i=this.FrameView.CreateFrame(+e.dataset.number+1);t.after(i[0]),this.FrameModel.setCurrentFrame(i[1]),s.redrawFrame(i[1],e),this.setFramesNumber(+e.dataset.number+1),i[2].addEventListener("click",()=>this.removeFrame(i[0],i[1])),i[3].addEventListener("click",()=>this.copyFrame(i[0],i[1])),this.activeFrame(),this.addClickFrame(),c.HiddenButton()}setFramesNumber(t){const e=document.querySelector("#frames").children;for(let i=t;i<this.FramesCount;i+=1)e[i].querySelector("canvas").dataset.number=i+1,e[i].querySelector("#num").innerHTML=i+1}static HiddenButton(){const t=document.querySelectorAll("#delete");if(t[0].style.visibility="visible",1===t.length)t[0].style.visibility="hidden";else for(let e=0;e<t[e];e+=1)t[e].style.visibility="visible"}beginRender(){return s.redrawFrame(this.FrameModel.getCurrentFrame(),this.canvas.canvas)}static getDatasetFrame(t){return document.querySelector(`*[data-number="${t}"]`)}}class d{constructor(){this.animationFrame={frame:document.getElementById("animation"),context:document.getElementById("animation").getContext("2d"),width:document.getElementById("animation").clientWidth,height:document.getElementById("animation").height}}clearAnimationFrame(){this.animationFrame.context.clearRect(0,0,this.animationFrame.width,this.animationFrame.height)}drawAnimation(t){this.clearAnimationFrame(),this.animationFrame.context.drawImage(t,0,0,t.width,t.height,0,0,200,200)}}class l{static fullScreenApi(t){return!!t.requestFullscreen&&(t.requestFullscreen(),!0)}}class h{constructor(){this.AnimationView=new d,this.fps=1,this.slider=document.querySelector("#slider input"),this.out=document.getElementById("out"),this.frameCount=0,this.startTime=0,this.flag=!0}addEventListeners(){this.slider.addEventListener("input",()=>{this.rewriteValue()}),document.getElementById("fullScreen").addEventListener("click",()=>l.fullScreenApi(document.getElementById("animation"))),this.animate()}rewriteValue(){this.out.innerHTML=`${this.slider.value}FPS`,this.fps=this.slider.value}animate(){return this.startTime=(new Date).getTime(),window.requestAnimationFrame(this.loop.bind(this))}loop(){const t=document.querySelectorAll("#frame");(new Date).getTime()-this.startTime>=1e3/this.fps&&(this.startTime=(new Date).getTime(),this.flag=!0,window.requestAnimationFrame(this.loop.bind(this))),t.length<=this.frameCount&&(this.frameCount=0),this.flag&&(this.AnimationView.drawAnimation(t[this.frameCount]),this.frameCount+=1,this.flag=!1),window.requestAnimationFrame(this.loop.bind(this))}}i.d(e,"a",function(){return u});class u{constructor(t){this.model=new r,this.canvas=new a(this.model,t),this.frameController=new c(t,this.canvas),this.Animation=new h,this.drawingState=!1,this.CanvasField=t,this.scaleCanv=0,this.ImgWidth=32,this.sizeNum=document.getElementById("numSize"),this.keyChange=!1,this.currentKey=null}active(){const t=document.querySelectorAll(".first ul li");for(let e=0;e<t.length;e+=1)this.model.getState()===t[e].id?t[e].style.borderColor="gold":t[e].style.borderColor="transparent"}addToolsListeners(){this.setButtonListeners(),this.canvas.drawing(),this.frameController.addFrameListeners(),this.Animation.addEventListeners(),this.setColorListeners(),this.setKeyListeners(),this.addKeyShortcuts()}addKeyShortcuts(){const t=document.querySelectorAll("#toolShorts li");for(let e=0;e<t.length;e+=1)t[e].addEventListener("click",()=>{t[e].style.borderColor="red",this.keyChange=!0,this.currentKey=t[e]})}setButtonListeners(){const t=document.querySelectorAll(".first ul li");this.resizeCanvas(),this.setPenSize();for(let e=0;e<t.length;e+=1)t[e].addEventListener("click",()=>{this.model.setState(t[e].id),this.active()});document.getElementById("cross").addEventListener("click",()=>{document.getElementById("shortcuts").style.visibility="hidden"}),document.getElementById("keyboard").addEventListener("click",()=>{document.getElementById("shortcuts").style.visibility="visible"})}setColorListeners(){document.getElementById("rightBut").addEventListener("change",()=>{this.canvas.changeColor(1)}),document.getElementById("leftBut").addEventListener("change",()=>{this.canvas.changeColor(0)}),document.oncontextmenu=t=>{this.canvas.left=!0;const e=t||window.event;e.preventDefault?e.preventDefault():e.returnValue=!1},document.getElementById("changeColor").addEventListener("click",a.replaceColor)}setKeyListeners(){document.addEventListener("keydown",t=>{if(this.keyChange){if(t.keyCode>20&&this.keyChange){const e=document.querySelectorAll("#toolShorts li");for(let i=0;i<e.length;i+=1)t.key.toUpperCase()!==e[i].innerHTML&&e[i]===this.currentKey?e[i].innerHTML=t.key.toUpperCase():t.key.toUpperCase()===e[i].innerHTML&&e[i]!==this.currentKey&&(e[i].innerHTML="?")}}else if(t.shiftKey)this.canvas.shift=!0;else if(t.ctrlKey)this.canvas.ctrl=!0;else if("Delete"===t.key)t.preventDefault(),this.canvas.deleteSelection();else if(!this.keyChange){const e=document.querySelectorAll("#toolShorts li");for(let i=0;i<e.length;i+=1)t.key.toUpperCase()===e[i].innerHTML&&document.getElementById(e[i].dataset.tool).click()}},!1),document.addEventListener("keyup",()=>{this.canvas.shift=!1,this.canvas.ctrl=!1,this.keyChange=!1,this.currentKey.style.borderColor="gold"},!1)}ActivePen(){const t=document.querySelectorAll("#penSizes ul li");for(let e=0;e<t.length;e+=1)this.model.getScale()===+t[e].dataset.pen?t[e].style.borderColor="gold":t[e].style.borderColor="transparent"}static ActiveSize(t){const e=document.querySelectorAll("#TransformTool li");for(let t=0;t<e.length;t+=1)e[t].style.borderColor="transparent";t.style.borderColor="gold"}updatePenSize(){this.model.setPenSize(this.model.getScale()*(this.CanvasField.width/this.model.getCanvasSize()))}setPenSize(){const t=document.querySelectorAll("#penSizes ul li");for(let e=0;e<t.length;e+=1)t[e].addEventListener("click",()=>{this.model.setScale(+t[e].dataset.pen),this.updatePenSize(),this.ActivePen(),localStorage.setItem("pen-size",+t[e].dataset.pen)})}resizeCanvas(){const t=new Image,e=document.querySelectorAll("#TransformTool li");for(let i=0;i<e.length;i+=1)e[i].addEventListener("click",()=>{t.src=this.CanvasField.canvas.toDataURL(),this.ImgOnload(t,e[i]),this.CanvasField.context.resetTransform(),this.CanvasField.context.restore()},!1)}ImgOnload(t,e){const i=t;let r;i.onload=()=>{r=this.ImgWidth/+e.dataset.size,this.drawImageScaled(i,r),this.model.setCanvasSize(+e.dataset.size),localStorage.setItem("canvas-size",+e.dataset.size),this.sizeNum.innerHTML=`[${+e.dataset.size} x ${+e.dataset.size}]`,this.updatePenSize(),u.ActiveSize(e),this.ImgWidth=+e.dataset.size}}drawImageScaled(t,e){this.CanvasField.context.save(),this.CanvasField.context.clearRect(0,0,832,832),this.CanvasField.context.imageSmoothingEnabled=!1,this.CanvasField.context.translate(832*-(e-1)/2,832*-(e-1)/2),this.CanvasField.context.scale(e,e),this.CanvasField.context.drawImage(t,0,0,832,832),this.CanvasField.context.restore()}}},function(t,e,i){"use strict";var r=i(0),n=i.n(r);function a(t){var e=this;return this.whoami="apng png animation encoder canvas",this.canvas=t,this.repeat=0,this.frame=-1,this.seqNumber=-1,this.delay_num=1,this.delay_den=1,this.dispose=0,this.blend=1,this.apngBytes,this.frameBytes,this.started=!1,this.closeStream=!1,this.start=function(){return this.started=!0,this.closeStream=!1,this.apngBytes=new o(0),this.frameBytes=new o(0),this.frame=-1,this.seqNumber=-1,0},this.setDelay=function(t){return this.delay_num=parseInt(t),this.delay_den=100,0},this.setRepeat=function(t){return t>=0&&(this.repeat=parseInt(t)),0},this.setDispose=function(t){return t<0||t>2?0:(this.dispose=parseInt(t),0)},this.setBlend=function(t){return t<0||t>1?0:(this.blend=parseInt(t),0)},this.addFrame=function(){if(null===this.canvas||!this.started||null===this.apngBytes)throw new Error("Please call start method before calling addFrame");this.frame+=1;var t=this.canvas.toDataURL("image/png").replace(/^data:image\/png;base64,/,"");if(this.frameBytes.bin=function(t){for(var e=atob(t),i=e.length,r=new Array(i),n=0;n<i;++n)r[n]=e.charCodeAt(n);return r}(t),0==this.frame){this.apngBytes.bin=this.apngBytes.bin.concat([137,80,78,71,13,10,26,10]);var e=this.frameBytes.findChunk("IHDR"),i=this.frameBytes.bin.slice(e.idx,e.idx+12+e.len);this.apngBytes.bin=this.apngBytes.bin.concat(i);var r=new Array(0),n=m((r=(r=(r=(r=r.concat([0,0,0,8])).concat(s("acTL"))).concat([0,0,0,1])).concat(d(this.repeat))).slice(4,16));r=r.concat(d(n)),this.apngBytes.bin=this.apngBytes.bin.concat(r);for(var a=this.frameBytes.findChunkAll("IDAT"),o=0;o<a.length;o++){if(0==o){this.seqNumber+=1;n=m((c=(c=(c=(c=(c=(c=(c=(c=(c=(c=(c=(c=new Array(0)).concat(d(26))).concat(s("fcTL"))).concat(d(this.seqNumber))).concat(d(this.canvas.width))).concat(d(this.canvas.height))).concat(d(0))).concat(d(0))).concat(h(this.delay_num))).concat(h(this.delay_den))).concat([this.dispose])).concat([this.blend])).slice(4,34));c=c.concat(d(n)),this.apngBytes.bin=this.apngBytes.bin.concat(c)}e=a[o];i=this.frameBytes.bin.slice(e.idx,e.idx+12+e.len);this.apngBytes.bin=this.apngBytes.bin.concat(i)}}if(this.frame>0)for(a=this.frameBytes.findChunkAll("IDAT"),o=0;o<a.length;o++){if(0==o){var c;this.seqNumber+=1;n=m((c=(c=(c=(c=(c=(c=(c=(c=(c=(c=(c=(c=new Array(0)).concat(d(26))).concat(s("fcTL"))).concat(d(this.seqNumber))).concat(d(this.canvas.width))).concat(d(this.canvas.height))).concat(d(0))).concat(d(0))).concat(h(this.delay_num))).concat(h(this.delay_den))).concat([this.dispose])).concat([this.blend])).slice(4,34));c=c.concat(d(n)),this.apngBytes.bin=this.apngBytes.bin.concat(c)}e=a[o];var l=this.frameBytes.bin.slice(e.idx+8,e.idx+8+e.len),u=e.len+4;this.seqNumber+=1;var g=new Array(0);n=m((g=(g=(g=(g=g.concat(d(u))).concat(s("fdAT"))).concat(d(this.seqNumber))).concat(l)).slice(4,8+u));g=g.concat(d(n)),this.apngBytes.bin=this.apngBytes.bin.concat(g)}return 0},this.finish=function(){if(!this.started)return!1;this.apngBytes.bin=this.apngBytes.bin.concat([0,0,0,0,73,69,78,68,174,66,96,130]);var t=this.apngBytes.findChunk("acTL"),e=d(this.frame+1);this.apngBytes.bin[t.idx+8]=e[0],this.apngBytes.bin[t.idx+8+1]=e[1],this.apngBytes.bin[t.idx+8+2]=e[2],this.apngBytes.bin[t.idx+8+3]=e[3];var i=d(m(this.apngBytes.bin.slice(t.idx+4,t.idx+4+4+8)));return this.apngBytes.bin[t.idx+4+4+8]=i[0],this.apngBytes.bin[t.idx+4+4+8+1]=i[1],this.apngBytes.bin[t.idx+4+4+8+2]=i[2],this.apngBytes.bin[t.idx+4+4+8+3]=i[3],this.started=!1,this.closeStream=!0,!0},this.stream=function(){return e.apngBytes},this}function o(t){function e(t,e,i){this.idx=t,this.len=e,this.type=i}return this.bin=new Array(t),this.findChunk=function(t){for(var i=8,r=null;i<this.bin.length;){var n=this.bin.slice(i,i+4),a=this.bin.slice(i+4,i+8),o=l(n),s=c(a);if(s===t)return r=new e(i,o,s);i+=8+o+4}return r},this.findChunkAll=function(t){for(var i=8,r=[];i<this.bin.length;){var n=this.bin.slice(i,i+4),a=this.bin.slice(i+4,i+8),o=l(n),s=c(a);if(s===t){var d=new e(i,o,s);r.push(d)}i+=8+o+4}return r},this.toStrHex=function(){return function(t){for(var e="",i=0;i<t.length;i++)e+=(r=t[i],n=2,(r+Math.pow(16,n)).toString(16).slice(-n).toUpperCase()+" ");var r,n;return e}(this.bin)},this.toStrBase64=function(){return function(t){for(var e="",i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return btoa(e)}(this.bin)},this.toStrAscii=function(){return function(t){for(var e="",i=0;i<t.length;i++)t[i]>32&&t[i]<127?e+=String.fromCharCode(t[i]):e+=".";return e}(this.bin)},this.toStrDec=function(){return function(t){for(var e="",i=0;i<t.length;i++)e+=("000"+t[i]).slice(-3),e+=" ";return e}(this.bin)},this}function s(t){var e=new Array(4);return e[0]=t.charCodeAt(0),e[1]=t.charCodeAt(1),e[2]=t.charCodeAt(2),e[3]=t.charCodeAt(3),e}function c(t){return String.fromCharCode(t[0])+String.fromCharCode(t[1])+String.fromCharCode(t[2])+String.fromCharCode(t[3])}function d(t){for(var e=t,i=[0,0,0,0],r=0;r<i.length;r++){var n=255&e;i[r]=n,e=(e-n)/256}return i.reverse()}function l(t){return(t[0]<<24)+(t[1]<<12)+(t[2]<<8)+t[3]}function h(t){for(var e=t,i=[0,0],r=0;r<i.length;r++){var n=255&e;i[r]=n,e=(e-n)/256}return i.reverse()}var u="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D".split(" ").map(function(t){return parseInt(t,16)});function m(t){if("string"==typeof t||t instanceof String)for(var e=new Array(t.length),i=0;i<t.length;i++)e[i]=t.charCodeAt(i);else{if(!Array.isArray(t))return alert("Bad input for CRC32 calculation: "+t),0;e=t}for(var r=-1,n=(i=0,e.length);i<n;i++)r=r>>>8^u[255&(r^e[i])];return(-1^r)>>>0}i.d(e,"a",function(){return g});class g{constructor(t){this.model=t}addEventListeners(){document.getElementById("gif").addEventListener("click",g.asGIF),document.getElementById("apng").addEventListener("click",g.asAPNG),document.getElementById("pscl").addEventListener("click",()=>this.asPSCL()),document.getElementById("importing").addEventListener("input",g.import)}asPSCL(){const t={};t.pen=this.model.getScale(),t.size=this.model.getCanvasSize(),t.fps=document.querySelector("#slider input").value,t.pictures=[];const e=document.querySelectorAll("#frame");for(let i=0;i<e.length;i+=1)t.pictures.push(e[i].toDataURL("image/png"));const i=JSON.stringify(t),r=document.createElement("a"),n=new Blob([i],{type:"text/plain"});r.href=URL.createObjectURL(n),r.download="newPiscel.pscl",r.click()}static import(){const t=document.getElementById("importing").files[0],e=new FileReader;e.readAsText(t),e.onload=t=>{const e=JSON.parse(t.target.result);document.querySelector("#slider input").value=e.fps,document.querySelector(`*[data-pen = "${e.pen}"`).click(),document.querySelector(`*[data-size = "${e.size}"`).click();const i=document.getElementById("add");let r=document.querySelectorAll("#frame");for(let t=r.length;t<e.pictures.length;t+=1)i.click();r=document.querySelectorAll("#frame");for(let t=1;t<e.pictures.length;t+=1){const i=new Image;i.src=e.pictures[t],i.onload=()=>{r[t].getContext("2d").drawImage(i,0,0,i.width,i.height,0,0,r[t].width,r[t].height)}}r[0].click()}}static asGIF(){const t=document.querySelectorAll("#frame"),e=document.createElement("canvas"),i=e.getContext("2d");e.width=600,e.height=600;const r=[];i.fillStyle="#fff";for(let n=0;n<t.length;n+=1){i.fillRect(0,0,e.width,e.height),i.drawImage(t[n],0,0,t[n].width,t[n].height,0,0,400,400);const a=new Image;a.src=e.toDataURL("image/png"),r.push(a)}n.a.createGIF({images:r,interval:1/document.querySelector("#slider input").value,gifWidth:128,gifHeight:128},t=>{if(!t.error){const e=t.image,i=document.createElement("img");i.src=e;const r=document.createElement("a");r.setAttribute("download","piskelGIF.gif"),r.setAttribute("href",i.src),r.click()}})}static asAPNG(){const t=document.querySelectorAll("#frame"),e=document.createElement("canvas"),i=e.getContext("2d"),r=new a(e);r.setRepeat(0),r.setDelay(100/document.querySelector("#slider input").value),r.setDispose(0),r.setBlend(1),r.start();for(let n=0;n<t.length;n+=1)i.fillStyle="#000",i.fillRect(0,0,e.width,e.height),i.drawImage(t[n],0,0,832,832,0,0,832,832),r.addFrame(i),i.clearRect(0,0,e.width,e.height),r.addFrame(i);r.finish();const n=window.document.createElement("a"),o=r.stream();n.href=URL.createObjectURL(new Blob([new Uint8Array(o.bin)],{type:"image/png"})),n.download="file.apng",document.body.appendChild(n),n.click(),document.body.removeChild(n)}}},function(t,e,i){"use strict";i.r(e),function(t){var e=i(1),r=i(2);function n(){if("none"===document.getElementById("logIn").style.display){const i=document.getElementById("uploading").files[0];t=i,e="Piscel",window.gapi.load("client",()=>{window.gapi.client.load("drive","v3",()=>{const i=String(Math.random()).slice(2),r=`\r\n--${i}\r\n`,n=`\r\n--${i}--`,a=new FileReader;a.readAsArrayBuffer(t),a.onload=()=>{const o=t.type||"application/octet-stream",s={title:e,mimeType:t.type},c=btoa(a.result),d=`${r}Content-Type: application/json\r\n\r\n${JSON.stringify(s)}${r}Content-Type: ${o}\r\n`+"Content-Transfer-Encoding: base64\r\n"+`\r\n${c}${n}`;window.gapi.client.request({path:"/upload/drive/v3/files",method:"POST",params:{uploadType:"multipart"},headers:{"Content-Type":`multipart/mixed; boundary="${i}"`},body:d}).then(()=>{document.querySelector(".upload").style.borderColor="green"},()=>{document.querySelector(".upload").style.borderColor="red"})}})})}else document.getElementById("logIn").click();var t,e}function a(t){document.getElementById("logIn").style.display="none",document.getElementById("logOut").style.display="block",document.getElementById("userPhoto").src=t.getBasicProfile().getImageUrl(),document.getElementById("userName").innerText=t.getBasicProfile().getName().toString(),document.querySelector(".NamePhoto").style.opacity="1"}function o(){document.getElementById("logIn").innerText="error"}function s(){window.gapi&&window.gapi.auth2&&window.gapi.auth2.getAuthInstance().signIn({}).then(a,o)}function c(){document.getElementById("logIn").style.display="block",document.getElementById("logOut").style.display="none",document.querySelector(".NamePhoto").style.opacity="0"}function d(){window.gapi.auth2.getAuthInstance().signOut().then(c,o)}window.onload=()=>{t.console.log("onload"),window.gapi.load("auth2",()=>{window.gapi.auth2.init({client_id:"261560799158-uhi1fc0jnl6ept2ocj7u96boukps0hcn.apps.googleusercontent.com",apiKey:"AIzaSyDZ1lvuvjaChMCUlEgxJqzGJnJ4hTLu19U",discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],scope:"https://www.googleapis.com/auth/drive.file"}).then(()=>{document.getElementById("logIn").addEventListener("click",s),document.getElementById("logOut").addEventListener("click",d),document.getElementById("uploading").addEventListener("input",n),(()=>{const t={canvas:document.getElementById("canvas"),context:document.getElementById("canvas").getContext("2d"),width:document.getElementById("canvas").width,height:document.getElementById("canvas").height},i=new e.a(t);if(i.addToolsListeners(),new r.a(i.model).addEventListeners(),localStorage.length>0)for(let t=0;t<localStorage.length;t+=1)"pen-size"===localStorage.key(t)?(i.model.setScale(localStorage.getItem(localStorage.key(t))),document.querySelector(`*[data-pen="${localStorage.getItem(localStorage.key(t))}"]`).click()):"canvas-size"===localStorage.key(t)&&(i.model.setCanvasSize(localStorage.getItem(localStorage.key(t))),document.querySelector(`*[data-size="${localStorage.getItem(localStorage.key(t))}"]`).click())})()},e=>t.console.log(`error initialization ${e}`))})}}.call(this,i(4))},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i}]);
//# sourceMappingURL=app.bundle.js.map